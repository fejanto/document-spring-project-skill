#!/usr/bin/env bash
# Post-implementation hook for documentation updates
# Generated by document-spring-project skill

# Detectar archivos modificados en src/main/ (no tests)
RECENT_FILES=$(git diff HEAD~1 HEAD --name-only 2>/dev/null | grep "^src/main/" || echo "")

if [ -z "$RECENT_FILES" ]; then
    exit 0
fi

# Filtrar cambios relevantes (controllers, services, entities, config)
RELEVANT_CHANGES=$(echo "$RECENT_FILES" | grep -E "(Controller|Service|Repository|Entity|Config)\.java$" || echo "")

if [ -z "$RELEVANT_CHANGES" ]; then
    exit 0
fi

# Detectar Ãºltimo commit de docs
LAST_DOC_COMMIT=$(git log -1 --format="%H" -- CLAUDE.md .claude/rules/ docs/ README.md 2>/dev/null)

if [ -z "$LAST_DOC_COMMIT" ]; then
    # Primera vez, no recordar aÃºn
    exit 0
fi

# Contar cambios desde Ãºltima actualizaciÃ³n de docs
CHANGES_COUNT=$(git diff "$LAST_DOC_COMMIT"..HEAD --name-only -- src/main/ | wc -l | tr -d ' ')

if [ "$CHANGES_COUNT" -lt 3 ]; then
    # Pocos cambios, no vale la pena recordar aÃºn
    exit 0
fi

# Mostrar recordatorio
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“ Recordatorio: DocumentaciÃ³n pendiente"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Se detectaron $CHANGES_COUNT archivos modificados en src/main/ desde la Ãºltima actualizaciÃ³n de docs."
echo ""
echo "Archivos modificados:"
echo "$RELEVANT_CHANGES" | head -5 | sed 's/^/  â€¢ /'
[ "$CHANGES_COUNT" -gt 5 ] && echo "  ... y $(($CHANGES_COUNT - 5)) mÃ¡s"
echo ""
echo "ğŸ’¡ Sugerencia: Actualiza la documentaciÃ³n"
echo "   Ejecuta: /docs"
echo "   Y elige: 2 (AnÃ¡lisis Incremental)"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
